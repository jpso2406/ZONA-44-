<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Carrito de Compras</title>
  <%= stylesheet_link_tag 'carta', media: 'all' %>
</head>
<body>
  <div class="menu-contenedor">
    <h4 class="mb-4 text-center text-primary">ðŸ›’ Carrito de Compras</h4>

    <% productos = @productos_en_carrito || [] %>
    <% if productos.empty? %>
      <div class="alert alert-warning text-center">No hay productos en el carrito.</div>
    <% else %>
      <ul class="lista-menu p-0">
        <% productos.group_by(&:id).each do |_, items| %>
          <% producto = items.first %>
          <% cantidad = items.size %>
          <li class="d-flex align-items-center border rounded mb-3 p-2 bg-light shadow-sm">
            <% if producto.foto.attached? %>
              <div class="foto me-3">
                <%= image_tag producto.foto.variant(resize_to_limit: [80, 80]), class: "rounded" %>
              </div>
            <% end %>
            <div class="flex-grow-1">
              <strong class="fs-5"><%= producto.name %></strong>
              <p class="mb-1 text-muted"><%= producto.descripcion %></p>
              <div>
                <span class="badge bg-primary">Cantidad: <%= cantidad %></span>
                <span class="ms-2 text-success">Total: $<%= number_with_delimiter(producto.precio * cantidad, delimiter: '.') %></span>
              </div>
              <small class="text-secondary">Precio unitario: $<%= number_with_delimiter(producto.precio, delimiter: '.') %></small>
            </div>
            <div class="ms-3">
              <%= button_to "Eliminar", eliminar_del_carrito_path(producto.id), method: :delete, class: "btn btn-danger btn-sm" %>
            </div>
          </li>
        <% end %>
      </ul>
    <% end %>
    <div class="text-center mt-4">
      <%= link_to "Volver al menÃº", menu_path, class: "btn btn-warning" %>
    </div>
  </div>
</body>
</html>
