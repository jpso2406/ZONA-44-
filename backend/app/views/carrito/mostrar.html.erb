<div class="menu-contenedor"> 
  <h5>ðŸ›’ <%= t("carrito.titulo") %></h5>

  <% productos = @productos_en_carrito || [] %>
  <% if productos.empty? %>
    <div class="alert alert-warning text-center"><%= t("carrito.vacio") %></div>
  <% else %>
    <ul class="lista-menu">
      <% productos.each do |producto| %>
        <% cantidad = session[:carrito].count(producto.id.to_s) %>
        <li class="producto-item">
          <% if producto.foto.attached? %>
            <div class="foto">
              <%= image_tag producto.foto.variant(resize_to_limit: [80, 80]) %>
            </div>
          <% end %>

          <div class="producto-detalles">
            <strong><%= producto.name %></strong>
            <p><%= producto.descripcion %></p>

            <div class="cantidad-controles">
              <%= button_to "-", reducir_del_carrito_path(producto.id.to_s), method: :post, class: "boton-cantidad" %>
              <span><%= cantidad %></span>
              <%= button_to "+", agregar_al_carrito_path(producto.id.to_s), method: :post, class: "boton-cantidad" %>
            </div>

            <p class="cantidad-total">
              <%= t("carrito.total") %>: $<%= number_with_delimiter(producto.precio * cantidad, delimiter: '.') %>
            </p>
            <p class="precio-unitario">
              <%= t("carrito.precio_unitario") %>: $<%= number_with_delimiter(producto.precio, delimiter: '.') %>
            </p>
          </div>

          <div>
            <%= button_to t("carrito.eliminar"), eliminar_del_carrito_path(producto.id), method: :delete, class: "boton-rojo" %>
          </div>
        </li>
      <% end %>
    </ul>
  <% end %>

  <div class="botones-navegacion mt-4">
    <% if session[:grupo_actual_id].present? && session[:grupo_actual_slug].present? %>
      <%= link_to t("botones.volver_grupo"), grupo_producto_index_path(session[:grupo_actual_id], session[:grupo_actual_slug]), class: "boton-amarillo" %>
    <% end %>

    <%= link_to "ðŸ“‹ #{t("botones.volver_categorias")}", grupo_index_path, class: "boton-amarillo" %>
    <%= link_to "ðŸ  #{t("botones.volver_inicio")}", root_path, class: "boton-verde" %>

    <% if @productos_en_carrito.present? %>
      <%= link_to "ðŸ’³ #{t("carrito.finalizar")}", new_checkout_path, class: "boton-verde" %>
    <% end %>
  </div>
</div>