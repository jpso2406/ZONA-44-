<!DOCTYPE html>
<html>
<head>
  <title>Panel de Administrador</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "admin_custom", media: "all" %>
  <%= javascript_importmap_tags %>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Inter font for modern look -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    html, body {
      background: #f4f6fa;
      font-family: 'Inter', Arial, sans-serif;
      color: #222;
    }
    main {
      overflow-y: auto;
      max-height: 90vh;
    }
    .nav-link.active {
      background-color: #f8f9fa;
      color: #0d6efd;
      font-weight: 600;
      border-radius: 0.25rem;
    }
    .card {
      transition: transform 0.2s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

  <nav class="navbar-admin mb-4">
  <span class="navbar-brand">Zona Admin</span>
  <% if admin_signed_in? %>
    <span class="admin-user">Bienvenido, <%= current_admin.email %></span>
    <%= link_to "Cerrar sesión", destroy_admin_session_path, method: :delete, data: { turbo: false, confirm: "¿Deseas cerrar sesión?" }, class: "btn btn-logout" %>
  <% end %>
</nav>

<div class="container-fluid">
  <div class="row">
    <aside class="col-md-2 sidebar-admin">
      <h3>Panel Admin</h3>
      <ul class="nav flex-column w-100" id="admin-menu">
        <li class="nav-item mb-2">
          <a class="nav-link" id="grupos-tab" href="#" onclick="event.preventDefault(); showSection('grupos')">
            <i class="bi bi-folder"></i> Grupos
          </a>
        </li>
        <li class="nav-item mb-2">
          <a class="nav-link" id="productos-tab" href="#" onclick="event.preventDefault(); showSection('productos')">
            <i class="bi bi-box"></i> Productos
          </a>
        </li>
        <li class="nav-item mb-2">
          <% link_to "promociones", admin_promociones_path %>
          <%# <a class="nav-link" id="promo" href="#" onclick="event.preventDefault(); showSection('promociones')">
            <i class="bi bi-pizza"></i> Promociones
          </a> %>
      </ul>
    </aside>

    <main class="col-md-10">
      <!-- Sección Grupos -->
      <section id="grupos-section" style="display: none;">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 style="font-weight:700;">Grupos</h2>
          <button class="btn btn-main" data-bs-toggle="modal" data-bs-target="#newGrupoModal">
            <i class="bi bi-plus-lg"></i> Nuevo Grupo
          </button>
        </div>
        <div class="row" id="grupos-list">
          <%= render partial: 'admin/grupo_card', collection: @grupos, as: :grupo %>
        </div>
      </section>

      <!-- Sección Productos -->
      <section id="productos-section" style="display: none;">
        <div class="row mb-4 align-items-center">
          <div class="col-md-6">
            <label for="filtro-grupo" style="font-weight:600;">Filtrar por grupo:</label>
            <select id="filtro-grupo" class="form-select" onchange="filtrarProductosPorGrupo()">
              <option value="">Todos</option>
              <% Grupo.all.each do |grupo| %>
                <option value="<%= grupo.id %>"><%= grupo.nombre %></option>
              <% end %>
            </select>
          </div>
          <div class="col-md-6 text-end">
            <button class="btn btn-main" data-bs-toggle="modal" data-bs-target="#nuevoItemModal">
              <i class="bi bi-plus-lg"></i> Nuevo Producto/Pizza
            </button>
          </div>
        </div>

        <div class="row" id="productos-list">
          <% if defined?(@productos) && @productos.any? %>
            <%= render partial: "admin/producto_card", collection: @productos, as: :producto %>
          <% end %>

          <% if defined?(@pizzas_tradicionales) && @pizzas_tradicionales.any? %>
            <%= render partial: "admin/pizza_tradicional_card", collection: @pizzas_tradicionales, as: :pizza %>
          <% end %>

          <% if defined?(@pizzas_especiales) && @pizzas_especiales.any? %>
            <%= render partial: "admin/pizza_especial_card", collection: @pizzas_especiales, as: :pizza %>
          <% end %>

          <% unless (defined?(@productos) && @productos.any?) || (defined?(@pizzas_tradicionales) && @pizzas_tradicionales.any?) || (defined?(@pizzas_especiales) && @pizzas_especiales.any?) %>
            <p>No hay productos ni pizzas disponibles.</p>
          <% end %>
        </div>
      </section>
      <!-- Sección Promociones -->
<section id="promociones-section" style="display: none;">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 style="font-weight:700;">Promociones</h2>
    <button class="btn btn-main" data-bs-toggle="modal" data-bs-target="#newPromoModal">
      <i class="bi bi-plus-lg"></i> Nueva Promoción
    </button>
  </div>
  <div class="row" id="promociones-list">
  </div>
  <%= render 'admin/promociones/lista', promociones: @promociones %>

</section>




    </main>
  </div>
</div>


<!-- Modales -->
<%= render 'admin/modal_nuevo_item' %>
<div class="modal fade" id="editGrupoModal" tabindex="-1" aria-labelledby="editGrupoModalLabel" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">Editar Grupo</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body" id="editGrupoModalBody"></div>
  </div></div>
</div>

<div class="modal fade" id="newGrupoModal" tabindex="-1" aria-labelledby="newGrupoModalLabel" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">Nuevo Grupo</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body" id="newGrupoModalBody"></div>
  </div></div>
</div>

<div class="modal fade" id="newProductoModal" tabindex="-1" aria-labelledby="newProductoModalLabel" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">Nuevo Producto</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body" id="newProductoModalBody"></div>
  </div></div>
</div>
<%= render 'admin/modal_nueva_promocion' %>



<%= render 'admin/new_pizza_modal' %>
<%= render 'admin/edit_pizza_modal' %>

<div class="modal fade" id="editProductoModal" tabindex="-1" aria-labelledby="editProductoModalLabel" aria-hidden="true">
  <div class="modal-dialog"><div class="modal-content">
    <div class="modal-header"><h5 class="modal-title">Editar Producto</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
    <div class="modal-body" id="editProductoModalBody"></div>
  </div></div>
</div>


<script>
 
  </script>
</body>
</html>
