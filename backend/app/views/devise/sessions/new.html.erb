<div id="loader" class="loader-container">
  <img src="<%= asset_path('animaciones/fire-loader.gif') %>" alt="Cargando..." class="fire-loader">
</div>

<div class="modal-login">
  <!-- üîÑ Switch de tema -->
  <div class="theme-toggle-switch">
    <input type="checkbox" id="theme-toggle" />
    <label for="theme-toggle" class="toggle-label">
      <span class="toggle-ball"></span>
      <span class="icon sun">‚òÄÔ∏è</span>
      <span class="icon moon">üåô</span>
    </label>
  </div>

  <div class="login-container">
    <h2 class="login-title">üîê <%= t("devise.login.title") %></h2>

    <%= form_for(resource, as: resource_name, url: session_path(resource_name), html: { class: "form-login" }) do |f| %>
      <div class="form-group">
        <%= f.label :email, t("devise.login.email"), class: "form-label" %>
        <%= f.email_field :email, autofocus: true, autocomplete: "email", class: "form-input" %>
      </div>

      <div class="form-group">
        <%= f.label :password, t("devise.login.password"), class: "form-label" %>
        <div class="password-container">
          <%= f.password_field :password, autocomplete: "current-password", class: "form-input", id: "password" %>
          <span class="toggle-password" onclick="togglePassword()"></span>
        </div>
      </div>

      <% if devise_mapping.rememberable? %>
        <div class="form-group form-check">
          <%= f.check_box :remember_me, class: "form-check-input" %>
          <%= f.label :remember_me, t("devise.login.remember_me"), class: "form-check-label" %>
        </div>
      <% end %>

      <%= f.submit t("devise.login.submit"), class: "btn-login" %>
    <% end %>

    <!-- üîó Links de Devise -->
    <div class="login-links">
      <%= render "devise/shared/links" %>
    </div>
  </div>
</div>

<!-- ‚ö†Ô∏è Alertas -->
<% if flash[:alert].present? %>
  <div id="alert-box" class="alert-error">
    <span class="alert-icon">‚ö†Ô∏è</span>
    <span class="alert-message"><%= flash[:alert] %></span>
    <span class="alert-close" onclick="document.getElementById('alert-box').remove()">‚úñ</span>
  </div>

  <script>
    setTimeout(() => {
      const alertBox = document.getElementById('alert-box');
      if (alertBox) alertBox.style.opacity = '0';

      setTimeout(() => {
        alertBox?.remove();
        window.location.reload();
      }, 1000);
    }, 5000);
  </script>

  <style>
    .alert-error {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(to right, #ffe0e0, #ffd6d6);
      color: #a30000;
      border: 1px solid #ff5e5e;
      padding: 12px 20px;
      border-radius: 12px;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 8px 20px rgba(255, 0, 0, 0.2);
      animation: fadeInSlide 0.6s ease-out;
      z-index: 9999;
      transition: opacity 1s ease;
    }

    .alert-icon {
      font-size: 26px;
    }

    .alert-message {
      font-weight: 600;
      font-size: 15px;
    }

    .alert-close {
      margin-left: auto;
      cursor: pointer;
      font-weight: bold;
      color: #a30000;
      transition: transform 0.2s ease;
    }

    .alert-close:hover {
      transform: scale(1.2);
    }

    @keyframes fadeInSlide {
      0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
      100% { opacity: 1; transform: translateX(-50%) translateY(0); }
    }
  </style>
<% end %>

<!-- üîë Scripts -->
<script>
  function togglePassword() {
    const passwordInput = document.getElementById("password");
    const icon = document.querySelector(".toggle-password");
    const isPassword = passwordInput.type === "password";
    passwordInput.type = isPassword ? "text" : "password";
    icon.textContent = isPassword ? "" : "";
  }
</script>

<script>
  document.addEventListener("turbo:load", function () {
    const loader = document.getElementById("loader");
    if (loader) {
      setTimeout(() => loader.classList.add("hidden"), 2000);
    }
  });
</script>

<script>
  const form = document.querySelector("form");
  if (form) {
    form.addEventListener("submit", () => {
      const loader = document.getElementById("loader");
      if (loader) loader.classList.remove("hidden");
    });
  }
</script>

<script>
  document.addEventListener("turbo:load", function () {
    const body = document.body;
    const toggle = document.getElementById("theme-toggle");
    if (!toggle) return;

    const savedTheme = localStorage.getItem("theme");
    if (savedTheme === "light") {
      body.classList.add("light-mode");
      toggle.checked = true;
    } else {
      body.classList.remove("light-mode");
      toggle.checked = false;
    }

    toggle.addEventListener("change", function () {
      if (toggle.checked) {
        body.classList.add("light-mode");
        localStorage.setItem("theme", "light");
      } else {
        body.classList.remove("light-mode");
        localStorage.setItem("theme", "dark");
      }
    });
  });
</script>
