<app-navbar></app-navbar>
<div class="pago-container">
  <!-- Header con diseño mejorado -->
  <div class="pago-header">
    <div class="header-content">
      <div class="title-section">
        <div class="title-wrapper">
          <i class="fas fa-credit-card title-icon"></i>
          <h1>{{ 'PAYMENT.HEADER.TITLE' | translate }}</h1>
        </div>
        <div class="order-summary">
          <div class="order-badge">
            <i class="fas fa-receipt"></i>
            <span>{{ 'PAYMENT.HEADER.ORDER' | translate }} #{{ orderId }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Contenido principal con diseño mejorado -->
  <div class="pago-content">
    <!-- Panel de información de PayU rediseñado -->
    <div class="payu-info">
      <div class="payu-header">
        <div class="payu-logo">
          <div class="logo-icon">
            <i class="fas fa-shield-alt"></i>
          </div>
          <div class="logo-text">
            <h3>{{ 'PAYMENT.PAYU.TITLE' | translate }}</h3>
            <span>{{ 'PAYMENT.PAYU.SUBTITLE' | translate }}</span>
          </div>
        </div>
      </div>
      
      <div class="payu-body">
        <p class="payu-description">
          <i class="fas fa-info-circle"></i>
          {{ 'PAYMENT.PAYU.DESCRIPTION' | translate }}
        </p>
        
        <div class="security-features">
          <h4><i class="fas fa-lock"></i> {{ 'PAYMENT.PAYU.SECURITY_TITLE' | translate }}</h4>
          <div class="security-badges">
            <div class="badge">
              <i class="fas fa-shield-alt"></i>
              <span>{{ 'PAYMENT.PAYU.SECURITY_SSL' | translate }}</span>
            </div>
            <div class="badge">
              <i class="fas fa-key"></i>
              <span>{{ 'PAYMENT.PAYU.SECURITY_ENCRYPTED' | translate }}</span>
            </div>
            <div class="badge">
              <i class="fas fa-check-circle"></i>
              <span>{{ 'PAYMENT.PAYU.SECURITY_VERIFIED' | translate }}</span>
            </div>
          </div>
        </div>

        <div class="payment-steps">
          <h4><i class="fas fa-list-ol"></i> {{ 'PAYMENT.PAYU.STEPS_TITLE' | translate }}</h4>
          <div class="steps">
            <div class="step">
              <span class="step-number">1</span>
              <span>{{ 'PAYMENT.PAYU.STEP1' | translate }}</span>
            </div>
            <div class="step">
              <span class="step-number">2</span>
              <span>{{ 'PAYMENT.PAYU.STEP2' | translate }}</span>
            </div>
            <div class="step">
              <span class="step-number">3</span>
              <span>{{ 'PAYMENT.PAYU.STEP3' | translate }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Formulario de pago rediseñado -->
    <div class="payment-form">
      <div class="form-header">
        <div class="form-title">
          <i class="fas fa-credit-card"></i>
          <h2>{{ 'PAYMENT.FORM.CARD_INFO' | translate }}</h2>
        </div>
        <div class="form-subtitle">
          <i class="fas fa-lock"></i>
          <span>{{ 'PAYMENT.FORM.SUBTITLE' | translate }}</span>
        </div>
      </div>
      
      <form (ngSubmit)="onSubmit()" #paymentForm="ngForm" class="payment-form-content">
        <!-- Número de tarjeta con validaciones mejoradas -->
        <div class="form-group">
          <label for="cardNumber">
            <i class="fas fa-credit-card"></i>
            {{ 'PAYMENT.FORM.NUMBER_LABEL' | translate }} *
          </label>
          <div class="input-wrapper">
            <div class="input-group" [class.error]="cardNumberInput.invalid && cardNumberInput.touched" 
                 [class.success]="cardNumberInput.valid && cardNumberInput.touched">
              <input 
                type="text" 
                id="cardNumber"
                name="cardNumber"
                #cardNumberInput="ngModel"
                [(ngModel)]="cardData.number"
                (input)="formatCardNumber($event)"
                (keypress)="onlyNumbers($event)"
                [disabled]="loading"
                required
                minlength="13"
                maxlength="19"
                pattern="[0-9\s]+"
                [placeholder]="'PAYMENT.FORM.NUMBER_PLACEHOLDER' | translate"
                class="form-control"
                autocomplete="cc-number">
              <div class="card-icons">
                <i class="fab fa-cc-visa" title="Visa"></i>
                <i class="fab fa-cc-mastercard" title="Mastercard"></i>
                <i class="fab fa-cc-amex" title="American Express"></i>
              </div>
              <div class="validation-icon" *ngIf="cardNumberInput.touched">
                <i class="fas fa-check-circle" *ngIf="cardNumberInput.valid"></i>
                <i class="fas fa-exclamation-circle" *ngIf="cardNumberInput.invalid"></i>
              </div>
            </div>
            <div class="error-message" *ngIf="cardNumberInput.invalid && cardNumberInput.touched">
              <i class="fas fa-exclamation-triangle"></i>
              <span *ngIf="cardNumberInput.errors?.['required']">{{ 'PAYMENT.ERRORS.NUMBER_REQUIRED' | translate }}</span>
              <span *ngIf="cardNumberInput.errors?.['minlength']">{{ 'PAYMENT.ERRORS.NUMBER_MINLENGTH' | translate }}</span>
              <span *ngIf="cardNumberInput.errors?.['pattern']">{{ 'PAYMENT.ERRORS.NUMBER_PATTERN' | translate }}</span>
            </div>
          </div>
        </div>

        <!-- Nombre en la tarjeta con validaciones -->
        <div class="form-group">
          <label for="cardName">
            <i class="fas fa-user"></i>
            {{ 'PAYMENT.FORM.NAME_LABEL' | translate }} *
          </label>
          <div class="input-wrapper">
            <div class="input-group" [class.error]="cardNameInput.invalid && cardNameInput.touched" 
                 [class.success]="cardNameInput.valid && cardNameInput.touched">
              <input 
                type="text" 
                id="cardName"
                name="cardName"
                #cardNameInput="ngModel"
                [(ngModel)]="cardData.name"
                [disabled]="loading"
                required
                minlength="2"
                maxlength="50"
                pattern="[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]+"
                [placeholder]="'PAYMENT.FORM.NAME_PLACEHOLDER' | translate"
                class="form-control"
                autocomplete="cc-name">
              <div class="validation-icon" *ngIf="cardNameInput.touched">
                <i class="fas fa-check-circle" *ngIf="cardNameInput.valid"></i>
                <i class="fas fa-exclamation-circle" *ngIf="cardNameInput.invalid"></i>
              </div>
            </div>
            <div class="error-message" *ngIf="cardNameInput.invalid && cardNameInput.touched">
              <i class="fas fa-exclamation-triangle"></i>
              <span *ngIf="cardNameInput.errors?.['required']">{{ 'PAYMENT.ERRORS.NAME_REQUIRED' | translate }}</span>
              <span *ngIf="cardNameInput.errors?.['minlength']">{{ 'PAYMENT.ERRORS.NAME_MINLENGTH' | translate }}</span>
              <span *ngIf="cardNameInput.errors?.['pattern']">{{ 'PAYMENT.ERRORS.NAME_PATTERN' | translate }}</span>
            </div>
          </div>
        </div>

        <!-- Fecha de expiración y CVV con validaciones completas -->
        <div class="form-row">
          <div class="form-group flex-1">
            <label for="cardExpiration">
              <i class="fas fa-calendar-alt"></i>
              {{ 'PAYMENT.FORM.EXPIRATION_LABEL' | translate }} *
            </label>
            <div class="input-wrapper">
              <div class="input-group" [class.error]="cardExpirationInput.invalid && cardExpirationInput.touched" 
                   [class.success]="cardExpirationInput.valid && cardExpirationInput.touched">
                <input 
                  type="text" 
                  id="cardExpiration"
                  name="cardExpiration"
                  #cardExpirationInput="ngModel"
                  [(ngModel)]="cardData.expiration"
                  (input)="formatExpiration($event)"
                  (keypress)="onlyNumbers($event, true)"
                  [disabled]="loading"
                  required
                  pattern="^(0[1-9]|1[0-2])\/\d{2}$"
                  [placeholder]="'PAYMENT.FORM.EXPIRATION_PLACEHOLDER' | translate"
                  class="form-control"
                  maxlength="5"
                  autocomplete="cc-exp">
                <div class="validation-icon" *ngIf="cardExpirationInput.touched">
                  <i class="fas fa-check-circle" *ngIf="cardExpirationInput.valid"></i>
                  <i class="fas fa-exclamation-circle" *ngIf="cardExpirationInput.invalid"></i>
                </div>
              </div>
              <div class="error-message" *ngIf="cardExpirationInput.invalid && cardExpirationInput.touched">
                <i class="fas fa-exclamation-triangle"></i>
                <span *ngIf="cardExpirationInput.errors?.['required']">{{ 'PAYMENT.ERRORS.EXPIRATION_REQUIRED' | translate }}</span>
                <span *ngIf="cardExpirationInput.errors?.['pattern']">{{ 'PAYMENT.ERRORS.EXPIRATION_PATTERN' | translate }}</span>
              </div>
            </div>
          </div>
          
          <div class="form-group flex-1">
            <label for="cardCvv">
              <i class="fas fa-shield-alt"></i>
              {{ 'PAYMENT.FORM.CVV_LABEL' | translate }} *
            </label>
            <div class="input-wrapper">
              <div class="input-group" [class.error]="cardCvvInput.invalid && cardCvvInput.touched" 
                   [class.success]="cardCvvInput.valid && cardCvvInput.touched">
                <input 
                  type="password" 
                  id="cardCvv"
                  name="cardCvv"
                  #cardCvvInput="ngModel"
                  [(ngModel)]="cardData.cvv"
                  (keypress)="onlyNumbers($event)"
                  [disabled]="loading"
                  required
                  minlength="3"
                  maxlength="4"
                  pattern="[0-9]+"
                  [placeholder]="'PAYMENT.FORM.CVV_PLACEHOLDER' | translate"
                  class="form-control"
                  autocomplete="cc-csc">
                <div class="cvv-help">
                  <i class="fas fa-question-circle" [title]="'PAYMENT.FORM.CVV_HINT' | translate"></i>
                </div>
                <div class="validation-icon" *ngIf="cardCvvInput.touched">
                  <i class="fas fa-check-circle" *ngIf="cardCvvInput.valid"></i>
                  <i class="fas fa-exclamation-circle" *ngIf="cardCvvInput.invalid"></i>
                </div>
              </div>
              <div class="error-message" *ngIf="cardCvvInput.invalid && cardCvvInput.touched">
                <i class="fas fa-exclamation-triangle"></i>
                <span *ngIf="cardCvvInput.errors?.['required']">{{ 'PAYMENT.ERRORS.CVV_REQUIRED' | translate }}</span>
                <span *ngIf="cardCvvInput.errors?.['minlength']">{{ 'PAYMENT.ERRORS.CVV_MINLENGTH' | translate }}</span>
                <span *ngIf="cardCvvInput.errors?.['pattern']">{{ 'PAYMENT.ERRORS.CVV_PATTERN' | translate }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Información de prueba mejorada -->
        <div class="test-info">
          <div class="test-header">
            <i class="fas fa-flask"></i>
          <h3>{{ 'PAYMENT.TEST.TITLE' | translate }}</h3>
          </div>
          <p class="test-description">
            <i class="fas fa-info-circle"></i>
          {{ 'PAYMENT.TEST.DESCRIPTION' | translate }}
          </p>
          <div class="test-cards">
            <div class="test-card-group">
              <h4><i class="fab fa-cc-visa"></i> {{ 'PAYMENT.TEST.CARDS_TITLE' | translate }}</h4>
              <div class="test-cards-grid">
                <div class="test-card">
                  <span class="card-type">{{ 'PAYMENT.TEST.VISA' | translate }}</span>
                  <span class="card-number">4111 1111 1111 1111</span>
                </div>
                <div class="test-card">
                  <span class="card-type">{{ 'PAYMENT.TEST.MASTERCARD' | translate }}</span>
                  <span class="card-number">5555 5555 5555 4444</span>
                </div>
              </div>
            </div>
            <div class="test-additional">
              <div class="test-item">
                <i class="fas fa-shield-alt"></i>
                <span><strong>CVV:</strong> 123</span>
              </div>
              <div class="test-item">
                <i class="fas fa-calendar"></i>
                <span><strong>{{ 'PAYMENT.TEST.DATE_LABEL' | translate }}:</strong> {{ 'PAYMENT.TEST.DATE_VALUE' | translate }}</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Loading overlay -->
        <div class="loading-overlay" *ngIf="loading">
          <div class="loading-content">
            <div class="loading-spinner">
              <i class="fas fa-credit-card fa-3x"></i>
              <div class="spinner"></div>
            </div>
            <h3>{{ 'PAYMENT.LOADING.TITLE' | translate }}</h3>
            <p>{{ 'PAYMENT.LOADING.DESCRIPTION' | translate }}</p>
            <div class="loading-progress">
              <div class="progress-bar"></div>
            </div>
          </div>
        </div>

        <!-- Mensajes de estado mejorados -->
        <div class="alert alert-error" *ngIf="error && !loading">
          <div class="alert-content">
            <i class="fas fa-exclamation-triangle"></i>
            <div class="alert-text">
              <strong>{{ 'PAYMENT.ALERT.ERROR_TITLE' | translate }}</strong>
              <span>{{ error }}</span>
            </div>
          </div>
          <button class="alert-dismiss" (click)="clearError()" [title]="'PAYMENT.ALERT.CLOSE' | translate">
            <span>{{ 'PAYMENT.ALERT.CLOSE' | translate }}</span>
            <i class="fas fa-check"></i>
          </button>
        </div>

        <div class="alert alert-success" *ngIf="success && !loading">
          <div class="alert-content">
            <i class="fas fa-check-circle"></i>
            <div class="alert-text">
              <strong>{{ 'PAYMENT.ALERT.SUCCESS_TITLE' | translate }}</strong>
              <span>{{ paymentResult?.message || ('PAYMENT.ALERT.SUCCESS_MESSAGE' | translate) }}</span>
            </div>
          </div>
          <div class="success-actions">
            <button class="btn-secondary" (click)="navigateToHome()">
              <i class="fas fa-home"></i>
              {{ 'PAYMENT.ALERT.GO_HOME' | translate }}
            </button>
          </div>
        </div>

        <!-- Botón de pago con validaciones completas -->
        <div class="form-actions">
          <div class="payment-summary">
            <div class="total-amount">
              <span>{{ 'PAYMENT.SUMMARY.TOTAL_LABEL' | translate }}</span>
              <strong>{{ orderTotal | currency:'COP':'symbol':'1.0-0' }}</strong>
            </div>
          </div>
          
          <!-- Validación general del formulario -->
          <div class="form-validation-summary" *ngIf="paymentForm.invalid && paymentForm.touched">
            <div class="validation-warning">
              <i class="fas fa-exclamation-circle"></i>
              <span>{{ 'PAYMENT.SUMMARY.VALIDATION' | translate }}</span>
            </div>
          </div>

          <button 
            type="submit" 
            class="btn-pay"
            [disabled]="loading || paymentForm.invalid || success"
            [class.loading]="loading"
            [class.success]="success"
            [class.disabled]="paymentForm.invalid">
            <div class="btn-content" *ngIf="!loading && !success">
              <i class="fas fa-credit-card"></i>
              <span>{{ 'PAYMENT.BUTTON.CONFIRM' | translate }}</span>
            </div>
            <div class="btn-content" *ngIf="loading">
              <i class="fas fa-spinner fa-spin"></i>
              <span>{{ 'PAYMENT.BUTTON.PROCESSING' | translate }}</span>
            </div>
            <div class="btn-content" *ngIf="success">
              <i class="fas fa-check-circle"></i>
              <span>{{ 'PAYMENT.BUTTON.SUCCESS' | translate }}</span>
            </div>
            <div class="btn-security" *ngIf="!loading">
              <i class="fas fa-lock"></i>
              <span>{{ success ? ('PAYMENT.BUTTON.SECURE_SUCCESS' | translate) : ('PAYMENT.BUTTON.SECURE_DEFAULT' | translate) }}</span>
            </div>
          </button>

          
      
        </div>
      </form>
    </div>
  </div>
</div>
<app-footer></app-footer>