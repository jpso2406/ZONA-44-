<!-- ===== NAVBAR ===== -->
<app-navbar></app-navbar>

<div class="order-container">
  <!-- ===== HEADER ===== -->
  <header class="order-header">
    <h1>Finalizar Pedido</h1>
  </header>

  <!-- ===== CONTENIDO PRINCIPAL ===== -->
  <main class="order-content">
   <!-- ===== SECCI√ìN: DATOS DEL CLIENTE ===== -->
<section class="customer-data">
  <h2>Datos del cliente</h2>

  <form (ngSubmit)="onSubmit()" #orderForm="ngForm" class="order-form">
    <div class="form-group">
      <label for="customerName">Nombre completo *</label>
      <input
        id="customerName"
        type="text"
        [(ngModel)]="customer.name"
        name="customerName"
        required
        placeholder="Ingresa tu nombre completo"
        class="form-control"
      />
    </div>

    <div class="form-group">
      <label for="customerEmail">Email *</label>
      <input
        id="customerEmail"
        type="email"
        [(ngModel)]="customer.email"
        name="customerEmail"
        required
        placeholder="tu@email.com"
        class="form-control"
      />
    </div>

    <div class="form-group">
      <label for="customerPhone">Tel√©fono *</label>
      <input
        id="customerPhone"
        type="tel"
        [(ngModel)]="customer.phone"
        name="customerPhone"
        required
        placeholder="300 123 4567"
        class="form-control"
      />
    </div>

    <!-- üîπ Bot√≥n dentro del formulario -->
    <div class="form-actions">
      <button
        type="submit"
        class="btn-submit"
        [disabled]="loading || orderForm.invalid"
      >
        <i class="fas fa-shopping-cart" *ngIf="!loading"></i>
        <i class="fas fa-spinner fa-spin" *ngIf="loading"></i>
        {{ loading ? "Procesando..." : "Confirmar Pedido" }}
      </button>
    </div>
  </form>
</section>


    <!-- ===== SECCI√ìN INFERIOR ===== -->
    <section class="bottom-section">
      <!-- ==== PEDIDO ==== -->
      <article class="pedido">
        <h2>Pedido</h2>

        <div class="summary-items" *ngFor="let item of cartItems">
          <div class="summary-item">
            <div class="item-info">
              <img [src]="item.foto_url" [alt]="item.name" class="item-image" />
              <div class="item-details">
                <h4>{{ item.name }}</h4>
                <span class="item-quantity">Cantidad: {{ item.cantidad }}</span>
              </div>
            </div>

            <div class="item-price">
              {{ item.precio * item.cantidad | currency: 'COP':'symbol' }}
            </div>
          </div>
        </div>

        <div class="summary-total">
          <div class="total-line">
            <span>Subtotal:</span>
            <span>{{ total | currency: 'COP':'symbol' }}</span>
          </div>
          <div class="total-line final">
            <span>Total:</span>
            <span>{{ total | currency: 'COP':'symbol' }}</span>
          </div>
        </div>
      </article>

      <!-- ==== TIPO DE ENTREGA ==== -->
      <section class="tipo-entrega">
        <h2>Tipo de entrega</h2>

        <!-- üîπ Botones estilo pesta√±as -->
        <div class="delivery-toggle">
          <button
            type="button"
            [class.active]="deliveryType === 'domicilio'"
            (click)="deliveryType = 'domicilio'"
          >
            <i class="fas fa-motorcycle"></i>
            Domicilio
          </button>

          <button
            type="button"
            [class.active]="deliveryType === 'recoger'"
            (click)="deliveryType = 'recoger'"
          >
            <i class="fas fa-store"></i>
            Recoger/Consumir
          </button>
        </div>

        <!-- üîπ Informaci√≥n din√°mica seg√∫n selecci√≥n -->
        <div class="delivery-info">
          <!-- === DOMICILIO === -->
          <div *ngIf="deliveryType === 'domicilio'">
            <p>
              <i class="fas fa-map-marker-alt"></i>
              Domicilio en:
              <a href="#" class="link" (click)="openMapModal($event)">Ingresa tu ubicaci√≥n</a>
            </p>
            <p>
              <i class="fas fa-clock"></i>
              Cuando: <strong>Lo antes posible</strong>
            </p>
            <p class="note">Costo de env√≠o: $2,000 COP</p>
          </div>

          <!-- === RECOGER === -->
          <div *ngIf="deliveryType === 'recoger'">
            <p><i class="fas fa-store"></i> Recoger en tienda</p>
            <p><i class="fas fa-clock"></i> Cuando: <strong>Lo antes posible</strong></p>
            <p class="note">Sin costo adicional</p>
          </div>
        </div>
      </section>
      <!-- ==== BOT√ìN FINAL ==== -->

    </section>
  </main>

  <!-- ===== FOOTER ===== -->
  <app-footer></app-footer>
</div>

<!-- ==== MODAL DE SELECCI√ìN DE UBICACI√ìN ==== -->
<div class="map-modal-overlay" *ngIf="showMapModal">
  <div class="map-modal" role="dialog" aria-modal="true">
    <header class="map-modal-header">
      <button class="close-btn" (click)="closeMapModal()">‚úï</button>
      <h3>Domicilio</h3>
    </header>

    <div class="map-modal-body">
      <div class="map-modal-controls">
        <input
          id="modalSearchBox"
          type="text"
          placeholder="Buscar direcci√≥n..."
          class="form-control"
        />
        <button class="btn btn-light use-loc" (click)="useCurrentLocation()">
          <i class="fas fa-location-arrow"></i> Utilizar mi ubicaci√≥n
        </button>
      </div>

      <div class="map-modal-map">
        <google-map
          height="320px"
          width="100%"
          [center]="modalCenter || center"
          [zoom]="zoom"
          [options]="mapOptions"
          (mapClick)="onModalMapClick($event)"
        >
          <map-marker
            *ngIf="modalMarkerPosition"
            [position]="modalMarkerPosition"
            [options]="{ draggable: true }"
            (mapDragEnd)="onModalMarkerDragEnd($event)"
          ></map-marker>
        </google-map>
      </div>
    </div>

    <footer class="map-modal-footer">
      <button class="btn btn-outline-secondary" (click)="closeMapModal()">
        Cancelar
      </button>
      <button class="btn btn-primary" (click)="confirmLocation()">
        Seleccionar ubicaci√≥n
      </button>
    </footer>
  </div>
</div>
