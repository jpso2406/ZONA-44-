<div class="order-container">
  <!-- ===== NAVBAR ===== -->
  <app-navbar></app-navbar>

  <!-- ===== HEADER ===== -->
  <div class="order-header">
    <h1>Finalizar Pedido</h1>
  </div>

  <!-- ===== CONTENIDO PRINCIPAL ===== -->
  <div class="order-content">
    <!-- ===== DATOS DEL CLIENTE ===== -->
    <div class="customer-data">
      <h2>Datos del cliente</h2>
      <form (ngSubmit)="onSubmit()" #orderForm="ngForm" class="order-form">
        <div class="form-group">
          <label>Nombre completo *</label>
          <input
            type="text"
            [(ngModel)]="customer.name"
            name="customerName"
            required
            placeholder="Ingresa tu nombre completo"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label>Email *</label>
          <input
            type="email"
            [(ngModel)]="customer.email"
            name="customerEmail"
            required
            placeholder="tu@email.com"
            class="form-control"
          />
        </div>

        <div class="form-group">
          <label>Tel√©fono *</label>
          <input
            type="tel"
            [(ngModel)]="customer.phone"
            name="customerPhone"
            required
            placeholder="300 123 4567"
            class="form-control"
          />
        </div>
      </form>
    </div>

    <!-- ===== SECCI√ìN INFERIOR ===== -->
    <div class="bottom-section">
      <!-- ==== PEDIDO ==== -->
      <div class="pedido">
        <h2>Pedido</h2>
        <div class="summary-items" *ngFor="let item of cartItems">
          <div class="summary-item">
            <div class="item-info">
              <img
                [src]="item.foto_url"
                [alt]="item.name"
                class="item-image"
              />
              <div class="item-details">
                <h4>{{ item.name }}</h4>
                <span class="item-quantity">Cantidad: {{ item.cantidad }}</span>
              </div>
            </div>
            <div class="item-price">
              {{ item.precio * item.cantidad | currency: 'COP':'symbol' }}
            </div>
          </div>
        </div>

        <div class="summary-total">
          <div class="total-line">
            <span>Subtotal:</span>
            <span>{{ total | currency: 'COP':'symbol' }}</span>
          </div>
          <div class="total-line final">
            <span>Total:</span>
            <span>{{ total | currency: 'COP':'symbol' }}</span>
          </div>
        </div>
      </div>

      <!-- ==== TIPO DE ENTREGA ==== -->
      <div class="tipo-entrega">
        <h2>Tipo de entrega</h2>
        <div class="delivery-options">
          <label class="delivery-option">
            <input
              type="radio"
              name="deliveryType"
              [(ngModel)]="deliveryType"
              value="recoger"
              required
            />
            <div class="option-content">
              <i class="fas fa-store"></i>
              <div>
                <span class="option-title"> Recoger en tienda </span>
                <span class="option-desc"> Sin costo adicional </span>
              </div>
            </div>
          </label>

          <label class="delivery-option">
            <input
              type="radio"
              name="deliveryType"
              [(ngModel)]="deliveryType"
              value="domicilio"
              required
            />
            <div class="option-content">
              <i class="fas fa-motorcycle"></i>
              <div>
                <span class="option-title"> Domicilio </span>
                <span class="option-desc"> Costo adicional: $3,000 </span>
              </div>
            </div>
          </label>
        </div>

        <div
          *ngIf="deliveryType === 'domicilio'"
          class="form-group"
          style="margin-top: 1rem"
        >
          <label>Direcci√≥n *</label>
          <textarea
            [(ngModel)]="deliveryAddress"
            name="deliveryAddress"
            rows="3"
            required
            placeholder="Ej: Calle 45 #10-20, Barrio Centro"
            class="form-control"
          ></textarea>

          <!-- üîπ MAPA GOOGLE: agregado -->
          <div class="map-section" style="margin-top: 1rem">
            <label>Selecciona tu ubicaci√≥n en el mapa</label>
            <input
              id="searchBox"
              type="text"
              placeholder="Buscar direcci√≥n..."
              class="form-control"
              style="margin-bottom: 0.5rem"
            />

            <google-map
              height="300px"
              width="100%"
              [center]="center"
              [zoom]="zoom"
              (mapClick)="onMapClick($event)"
            >
              <map-marker
                *ngIf="markerPosition"
                [position]="markerPosition"
                [options]="{ draggable: true }"
                (mapDragEnd)="onMarkerDragEnd($event)"
              ></map-marker>
            </google-map>
          </div>
        </div>
      </div>
    </div>

    <!-- ==== BOT√ìN FINAL ==== -->
    <div class="form-actions">
      <button
        type="submit"
        class="btn-submit"
        [disabled]="loading || orderForm.invalid"
      >
        <i class="fas fa-shopping-cart" *ngIf="!loading"></i>
        <i class="fas fa-spinner fa-spin" *ngIf="loading"></i>
        {{ loading ? "Procesando..." : "Confirmar Pedido" }}
      </button>
    </div>
  </div>

  <!-- ===== FOOTER ===== -->
  <app-footer></app-footer>
</div>
