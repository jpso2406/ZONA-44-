<div class="admin-productos">
  <div class="page-header">
    <h1><i class="fas fa-box"></i> Gestión de Productos</h1>
    <p>Administra los productos del menú</p>
  </div>

  <!-- Formulario para crear/editar producto -->
  <div class="form-section">
    <div class="form-card">
      <h3>{{ isEditing ? 'Editar Producto' : 'Crear Nuevo Producto' }}</h3>
      
      <form (ngSubmit)="isEditing ? updateProducto() : createProducto()" #form="ngForm">
        <div class="form-row">
          <div class="form-group">
            <label for="nombre">Nombre del Producto *</label>
            <input 
              type="text" 
              id="nombre" 
              name="nombre" 
              [(ngModel)]="productoForm.nombre" 
              required 
              class="form-control"
              placeholder="Ej: Hamburguesa Clásica">
          </div>
          
          <div class="form-group">
            <label for="precio">Precio *</label>
            <input 
              type="number" 
              id="precio" 
              name="precio" 
              [(ngModel)]="productoForm.precio" 
              required 
              min="0"
              step="100"
              class="form-control"
              placeholder="25000">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="grupo_id">Grupo *</label>
            <select 
              id="grupo_id" 
              name="grupo_id" 
              [(ngModel)]="productoForm.grupo_id" 
              required 
              class="form-control">
              <option value="">Seleccionar grupo</option>
              <option *ngFor="let grupo of grupos" [value]="grupo.id">
                {{ grupo.nombre }}
              </option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="stock">Stock</label>
            <input 
              type="number" 
              id="stock" 
              name="stock" 
              [(ngModel)]="productoForm.stock" 
              min="0"
              class="form-control"
              placeholder="100">
          </div>
        </div>

        <div class="form-group">
          <label for="descripcion">Descripción</label>
          <textarea 
            id="descripcion" 
            name="descripcion" 
            [(ngModel)]="productoForm.descripcion" 
            class="form-control"
            rows="3"
            placeholder="Descripción del producto"></textarea>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input 
              type="checkbox" 
              name="activo" 
              [(ngModel)]="productoForm.activo"
              class="form-checkbox">
            <span class="checkmark"></span>
            Producto activo (disponible para venta)
          </label>
        </div>

        <div class="form-actions">
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="!form.valid || loading">
            <i class="fas fa-save"></i>
            {{ isEditing ? 'Actualizar' : 'Crear' }} Producto
          </button>
          
          <button 
            type="button" 
            class="btn btn-secondary"
            (click)="cancelEdit()"
            [disabled]="loading">
            <i class="fas fa-times"></i>
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Lista de productos -->
  <div class="list-section">
    <div class="list-header">
      <h3>Productos Existentes</h3>
      <div class="list-actions">
        <button class="btn btn-outline" (click)="loadProductos()" [disabled]="loading">
          <i class="fas fa-sync-alt"></i>
          Actualizar
        </button>
      </div>
    </div>

    <div class="loading" *ngIf="loading">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Cargando productos...</p>
    </div>

    <div class="error" *ngIf="error">
      <i class="fas fa-exclamation-triangle"></i>
      <p>{{ error }}</p>
      <button class="btn btn-outline" (click)="loadProductos()">Reintentar</button>
    </div>

    <div class="success" *ngIf="success">
      <i class="fas fa-check-circle"></i>
      <p>{{ success }}</p>
    </div>

    <div class="productos-table" *ngIf="!loading && !error">
      <div class="table-header">
        <span>Imagen</span>
        <span>Nombre</span>
        <span>Grupo</span>
        <span>Precio</span>
        <span>Stock</span>
        <span>Estado</span>
        <span>Acciones</span>
      </div>
      
      <div class="table-row" *ngFor="let producto of productos">
        <div class="producto-image">
          <img *ngIf="producto.foto_url" [src]="producto.foto_url" [alt]="producto.nombre">
          <div *ngIf="!producto.foto_url" class="image-placeholder">
            <i class="fas fa-image"></i>
          </div>
        </div>
        
        <span class="producto-nombre">{{ producto.nombre }}</span>
        <span class="producto-grupo">{{ getGrupoNombre(producto.grupo_id) }}</span>
        <span class="producto-precio">${{ producto.precio | number:'1.0-0' }}</span>
        <span class="producto-stock">{{ producto.stock || 'Sin límite' }}</span>
        <span [class]="'producto-estado ' + (producto.activo ? 'activo' : 'inactivo')">
          {{ producto.activo ? 'Activo' : 'Inactivo' }}
        </span>
        
        <div class="producto-actions">
          <button class="btn btn-sm btn-primary" (click)="editProducto(producto)">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn btn-sm btn-danger" (click)="deleteProducto(producto.id!)">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="!loading && !error && productos.length === 0">
      <i class="fas fa-box"></i>
      <h4>No hay productos creados</h4>
      <p>Crea tu primer producto para comenzar</p>
    </div>
  </div>
</div>