<div class="admin-promociones">
  <div class="page-header">
    <h1><i class="fas fa-tags"></i> Gestión de Promociones</h1>
    <p>Administra las promociones y ofertas especiales</p>
  </div>

  <!-- Alertas -->
  <div class="alert alert-error" *ngIf="error">
    <i class="fas fa-exclamation-circle"></i>
    <span>{{ error }}</span>
  </div>

  <div class="alert alert-success" *ngIf="success">
    <i class="fas fa-check-circle"></i>
    <span>{{ success }}</span>
  </div>

  <!-- Formulario para crear/editar promoción -->
  <div class="form-section">
    <div class="form-card">
      <h3>{{ isEditing ? 'Editar Promoción' : 'Crear Nueva Promoción' }}</h3>
      
      <form (ngSubmit)="isEditing ? updatePromocion() : createPromocion()" #form="ngForm">
        <div class="form-row">
          <div class="form-group">
            <label for="nombre">Nombre de la Promoción *</label>
            <input 
              type="text" 
              id="nombre" 
              name="nombre" 
              [(ngModel)]="promocionForm.nombre" 
              required 
              class="form-control"
              placeholder="Ej: 2x1 en Hamburguesas">
          </div>
          
          <div class="form-group">
            <label for="producto_id">Producto *</label>
            <select 
              id="producto_id" 
              name="producto_id" 
              [(ngModel)]="promocionForm.producto_id" 
              required 
              class="form-control">
              <option value="">Seleccionar producto...</option>
              <option *ngFor="let producto of productos" [value]="producto.id">
                {{ producto.name }} - {{ formatPrice(producto.precio) }}
              </option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="precio_original">Precio Original *</label>
            <input 
              type="number" 
              id="precio_original" 
              name="precio_original" 
              [(ngModel)]="promocionForm.precio_original" 
              required 
              min="0"
              step="100"
              class="form-control"
              placeholder="50000"
              (input)="calculateTotalPrice()">
          </div>
          
          <div class="form-group">
            <label for="descuento">Descuento (%) *</label>
            <input 
              type="number" 
              id="descuento" 
              name="descuento" 
              [(ngModel)]="promocionForm.descuento" 
              required 
              min="1"
              max="100"
              class="form-control"
              placeholder="20"
              (input)="calculateTotalPrice()">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="precio_total">Precio Total *</label>
            <input 
              type="number" 
              id="precio_total" 
              name="precio_total" 
              [(ngModel)]="promocionForm.precio_total" 
              required 
              min="0"
              step="100"
              class="form-control"
              placeholder="40000"
              (input)="calculateDiscount()">
          </div>
          
          <div class="form-group">
            <label for="imagen">Imagen de la Promoción</label>
            <input 
              type="file" 
              id="imagen" 
              name="imagen" 
              accept="image/*"
              class="form-control"
              (change)="onImageSelected($event)">
          </div>
        </div>

        <!-- Preview de imagen -->
        <div class="form-group" *ngIf="selectedImagePreview">
          <label>Vista previa:</label>
          <div class="image-preview">
            <img [src]="selectedImagePreview" alt="Preview" class="preview-image">
          </div>
        </div>

        <div class="form-actions">
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="loading || !form.form.valid">
            <i class="fas fa-save"></i>
            {{ isEditing ? 'Actualizar' : 'Crear' }} Promoción
          </button>
          
          <button 
            type="button" 
            class="btn btn-outline" 
            (click)="cancelEdit()" 
            *ngIf="isEditing">
            <i class="fas fa-times"></i>
            Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Lista de promociones -->
  <div class="list-section">
    <div class="list-header">
      <h3>Promociones ({{ promociones.length }})</h3>
      <div class="list-actions">
        <button class="btn btn-outline" (click)="loadPromociones()" [disabled]="loading">
          <i class="fas fa-sync-alt" [class.fa-spin]="loading"></i>
          Actualizar
        </button>
      </div>
    </div>

    <div class="loading" *ngIf="loading && promociones.length === 0">
      <i class="fas fa-spinner fa-spin"></i>
      <p>Cargando promociones...</p>
    </div>

    <div class="error" *ngIf="error && promociones.length === 0">
      <i class="fas fa-exclamation-triangle"></i>
      <p>{{ error }}</p>
      <button class="btn btn-outline" (click)="loadPromociones()">Reintentar</button>
    </div>

    <div class="promociones-table" *ngIf="!loading || promociones.length > 0">
      <div class="table-header">
        <span data-label="Imagen">Imagen</span>
        <span data-label="Promoción">Promoción</span>
        <span data-label="Producto">Producto</span>
        <span data-label="Precios">Precios</span>
        <span data-label="Descuento">Descuento</span>
        <span data-label="Acciones">Acciones</span>
      </div>
      
      <div class="table-row" *ngFor="let promocion of promociones">
        <div class="promocion-image" data-label="Imagen">
          <img 
            [src]="promocion.imagen_url || '/assets/no-image.png'" 
            [alt]="promocion.nombre"
            class="product-image">
        </div>
        
        <div class="promocion-info" data-label="Promoción">
          <div class="promocion-nombre">{{ promocion.nombre }}</div>
          <div class="promocion-id">ID: #{{ promocion.id }}</div>
        </div>
        
        <div class="producto-info" data-label="Producto">
          <div class="producto-nombre">{{ getProductoName(promocion.producto_id) }}</div>
          <div class="producto-id">ID: #{{ promocion.producto_id }}</div>
        </div>
        
        <div class="precios-info" data-label="Precios">
          <div class="precio-original">Original: {{ formatPrice(promocion.precio_original) }}</div>
          <div class="precio-total">Total: {{ formatPrice(promocion.precio_total) }}</div>
          <div class="ahorro">Ahorro: {{ formatPrice(promocion.precio_original - promocion.precio_total) }}</div>
        </div>
        
        <span class="descuento-badge" data-label="Descuento">{{ promocion.descuento }}%</span>
        
        <div class="promocion-actions" data-label="Acciones">
          <button class="btn btn-sm btn-primary" (click)="startEdit(promocion)" title="Editar">
            <i class="fas fa-edit"></i>
          </button>
          
          <button class="btn btn-sm btn-danger" (click)="deletePromocion(promocion.id)" title="Eliminar">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="!loading && !error && promociones.length === 0">
      <i class="fas fa-tags"></i>
      <h4>No hay promociones</h4>
      <p>Aún no hay promociones registradas</p>
    </div>
  </div>
</div>