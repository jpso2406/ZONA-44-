
<!-- ============================= -->
<!-- PÁGINA DE GESTIÓN DE ANUNCIOS -->
<!-- ============================= -->
<div class="admin-anuncios">
  
  <!-- ===== SECCIÓN DE ENCABEZADO PRINCIPAL ===== -->
  <header class="page-header">
    <div class="header-content">
      <h1>
        <i class="fas fa-bullhorn"></i> 
        Gestión de Anuncios
      </h1>
      <p>Administra los anuncios del sistema</p>
    </div>
    
    <!-- Botón para crear nuevo anuncio -->
    <div class="header-actions">
      <button 
        class="btn btn-primary btn-create-new"
        (click)="openCreateModal()"
        [disabled]="loading">
        <i class="fas fa-plus-circle"></i>
        <span>Crear Nuevo Anuncio</span>
      </button>
    </div>
  </header>

  <!-- ===== SECCIÓN DE FILTROS ===== -->
  <section class="filtros-section">
    <div class="filtros-container">
      <div class="filtros-header">
        <h3>
          <i class="fas fa-filter"></i>
          Filtros de Búsqueda
        </h3>
      </div>
      
      <div class="filtros-content">
        <!-- Filtro por Estado -->
        <div class="filtro-group">
          <label for="filtro-activo">Filtrar por Estado:</label>
          <select 
            id="filtro-activo" 
            class="form-control"
            [(ngModel)]="filtroActivo"
            (ngModelChange)="onFiltroActivoChange()">
            <option value="todos">Todos los estados</option>
            <option value="activo">Activos</option>
            <option value="inactivo">Inactivos</option>
          </select>
        </div>

        <!-- Filtro por Texto -->
        <div class="filtro-group">
          <label for="filtro-texto">Buscar por posición:</label>
          <input 
            type="text" 
            id="filtro-texto" 
            class="form-control"
            placeholder="Buscar por posición..."
            [(ngModel)]="filtroTexto"
            (ngModelChange)="onFiltroTextoChange()">
        </div>

        <!-- Botón para limpiar filtros -->
        <div class="filtro-group filtro-actions">
          <button 
            class="btn btn-outline btn-clear-filters"
            (click)="limpiarFiltros()"
            [disabled]="filtroActivo === 'todos' && !filtroTexto">
            <i class="fas fa-eraser"></i>
            <span>Limpiar Filtros</span>
          </button>
        </div>
      </div>

      <!-- Resultados del filtro -->
      <div class="filtros-resultado" *ngIf="filtroActivo !== 'todos' || filtroTexto">
        <p>
          <i class="fas fa-search"></i>
          Mostrando <strong>{{ anunciosFiltrados.length }}</strong> de <strong>{{ anuncios.length }}</strong> anuncios
          <span *ngIf="filtroActivo !== 'todos'">(Estado: {{ filtroActivo === 'activo' ? 'Activos' : 'Inactivos' }})</span>
          <span *ngIf="filtroTexto">(Búsqueda: "{{ filtroTexto }}")</span>
        </p>
      </div>
    </div>
  </section>

  <!-- ===== SECCIÓN DE LISTA DE ANUNCIOS ===== -->
  <section class="list-section">
    
    <!-- Encabezado de la Lista -->
    <header class="list-header">
      <div class="header-info">
        <h3>
          <i class="fas fa-list"></i>
          Anuncios Existentes
        </h3>
        <p class="header-subtitle">
          Total de anuncios: <strong>{{ anuncios.length }}</strong>
          <span *ngIf="filtroActivo !== 'todos' || filtroTexto" class="filtrado-info">
            (Mostrando: {{ anunciosFiltrados.length }})
          </span>
        </p>
      </div>
      
      <div class="list-actions">
        <button 
          class="btn btn-outline" 
          (click)="loadAnuncios()" 
          [disabled]="loading">
          <i class="fas fa-{{ loading ? 'spinner fa-spin' : 'sync-alt' }}"></i>
          <span>{{ loading ? 'Actualizando...' : 'Actualizar' }}</span>
        </button>
      </div>
    </header>

    <!-- ===== ESTADOS DE CARGA Y ERROR ===== -->
    
    <!-- Estado de Carga -->
    <div class="loading" *ngIf="loading">
      <i class="fas fa-spinner fa-spin"></i>
      <h4>Cargando anuncios...</h4>
      <p>Por favor espera mientras se cargan los datos</p>
    </div>

    <!-- Estado de Error -->
    <div class="error" *ngIf="error && !loading">
      <i class="fas fa-exclamation-triangle"></i>
      <h4>Error al cargar anuncios</h4>
      <p>{{ error }}</p>
      <button class="btn btn-outline" (click)="loadAnuncios()">
        <i class="fas fa-retry"></i>
        Reintentar
      </button>
    </div>

    <!-- Estado de Éxito -->
    <div class="success" *ngIf="success && !loading && !error">
      <i class="fas fa-check-circle"></i>
      <h4>¡Operación exitosa!</h4>
      <p>{{ success }}</p>
    </div>

    <!-- ===== GRID DE ANUNCIOS (PAGINADO) ===== -->
    <div class="anuncios-grid" *ngIf="!loading && !error && paginatedAnuncios.length > 0">
      
      <!-- Card de cada anuncio -->
      <article 
        class="anuncio-card" 
        *ngFor="let anuncio of paginatedAnuncios; trackBy: trackByAnuncioId">
        
        <!-- Imagen del anuncio -->
        <div class="anuncio-image">
          <img 
            *ngIf="anuncio.imagen_url" 
            [src]="anuncio.imagen_url" 
            [alt]="'Anuncio ' + anuncio.posicion"
            loading="lazy">
          <div *ngIf="!anuncio.imagen_url" class="placeholder">
            <i class="fas fa-image"></i>
          </div>
        </div>
        
        <!-- Contenido del anuncio -->
        <div class="anuncio-content">
          <div class="anuncio-header">
            <h4>Posición: {{ anuncio.posicion }}</h4>
            <span class="estado-badge" [ngClass]="getEstadoClass(anuncio.activo)">
              {{ getEstadoText(anuncio.activo) }}
            </span>
          </div>
          
          <div class="anuncio-dates" *ngIf="anuncio.fecha_inicio || anuncio.fecha_fin">
            <p *ngIf="anuncio.fecha_inicio" class="date-info">
              <i class="fas fa-calendar-alt"></i>
              <strong>Inicio:</strong> {{ anuncio.fecha_inicio | date:'short' }}
            </p>
            <p *ngIf="anuncio.fecha_fin" class="date-info">
              <i class="fas fa-calendar-check"></i>
              <strong>Fin:</strong> {{ anuncio.fecha_fin | date:'short' }}
            </p>
          </div>
        </div>
        
        <!-- Acciones del anuncio -->
        <div class="anuncio-actions">
          <button 
            class="btn btn-sm btn-primary" 
            (click)="openEditModal(anuncio)"
            [disabled]="loading">
            <i class="fas fa-edit"></i>
            <span>Editar</span>
          </button>
          
          <button 
            class="btn btn-sm btn-danger" 
            (click)="openDeleteModal(anuncio)"
            [disabled]="loading">
            <i class="fas fa-trash"></i>
            <span>Eliminar</span>
          </button>
        </div>
      </article>
    </div>

    <!-- paginación -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button class="btn" (click)="prevPage()" [disabled]="currentPage === 1"><i class="fas fa-chevron-left"></i></button>
      <button class="btn page-number" *ngFor="let i of [].constructor(totalPages); let idx = index" (click)="goToPage(idx+1)" [class.active]="currentPage === (idx+1)">
        {{ idx+1 }}
      </button>
      <button class="btn" (click)="nextPage()" [disabled]="currentPage === totalPages"><i class="fas fa-chevron-right"></i></button>
    </div>

    <!-- ===== ESTADO VACÍO ===== -->
    <div class="empty-state" *ngIf="!loading && !error && anunciosFiltrados.length === 0 && anuncios.length === 0">
      <i class="fas fa-bullhorn"></i>
      <h4>No hay anuncios creados</h4>
      <p>Crea tu primer anuncio para comenzar a gestionar tus promociones</p>
    </div>

    <!-- ===== ESTADO SIN RESULTADOS DE FILTRO ===== -->
    <div class="empty-state" *ngIf="!loading && !error && anunciosFiltrados.length === 0 && anuncios.length > 0">
      <i class="fas fa-search"></i>
      <h4>No se encontraron anuncios</h4>
      <p>No hay anuncios que coincidan con los filtros aplicados</p>
      <button 
        class="btn btn-outline" 
        (click)="limpiarFiltros()">
        <i class="fas fa-eraser"></i>
        Limpiar Filtros
      </button>
    </div>
  </section>
</div>

<!-- ============================= -->
<!--     MODALES DEL SISTEMA       -->
<!-- ============================= -->

<!-- MODAL PARA CREAR ANUNCIO -->
<div class="modal-overlay" *ngIf="showCreateModal" (click)="closeCreateModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    
    <!-- Encabezado del Modal -->
    <header class="modal-header">
      <h3>
        <i class="fas fa-plus-circle"></i>
        Crear Nuevo Anuncio
      </h3>
      <button 
        class="modal-close" 
        (click)="closeCreateModal()"
        type="button">
        <i class="fas fa-times"></i>
      </button>
    </header>
    
    <!-- Cuerpo del Modal -->
    <div class="modal-body">
      <form (ngSubmit)="createAnuncio()" #createForm="ngForm">
        
        <!-- Información Básica -->
        <section class="form-section">
          <h4>
            <i class="fas fa-info-circle"></i>
            Información Básica
          </h4>
          
          <div class="form-row">
            <div class="form-group">
              <label for="create-activo">Estado *</label>
              <select 
                id="create-activo" 
                name="activo" 
                [(ngModel)]="anuncioForm.activo" 
                required 
                class="form-control">
                <option [ngValue]="true">Activo</option>
                <option [ngValue]="false">Inactivo</option>
              </select>
              <small class="form-text">Estado del anuncio</small>
            </div>
            
            <div class="form-group">
              <label for="create-posicion">Posición *</label>
              <input 
                type="number" 
                id="create-posicion" 
                name="posicion" 
                [(ngModel)]="anuncioForm.posicion" 
                required 
                min="0"
                class="form-control"
                placeholder="0">
              <small class="form-text">Orden de visualización (menor número = primero)</small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="create-fecha-inicio">Fecha de Inicio</label>
              <input 
                type="date" 
                id="create-fecha-inicio" 
                name="fecha_inicio" 
                [(ngModel)]="anuncioForm.fecha_inicio" 
                class="form-control">
              <small class="form-text">Fecha desde la cual el anuncio estará activo</small>
            </div>

            <div class="form-group">
              <label for="create-fecha-fin">Fecha de Fin</label>
              <input 
                type="date" 
                id="create-fecha-fin" 
                name="fecha_fin" 
                [(ngModel)]="anuncioForm.fecha_fin" 
                class="form-control">
              <small class="form-text">Fecha hasta la cual el anuncio estará activo</small>
            </div>
          </div>
        </section>

        <!-- Imagen -->
        <section class="form-section">
          <h4>
            <i class="fas fa-camera"></i>
            Imagen
          </h4>
          
          <div class="form-group">
            <label for="create-imagen">Imagen del Anuncio *</label>
            
            <!-- Preview de imagen seleccionada -->
            <div class="image-preview" *ngIf="selectedImagePreview">
              <img [src]="selectedImagePreview" alt="Preview" class="preview-image">
              <p class="preview-text">Vista previa</p>
            </div>
            
            <input 
              type="file" 
              id="create-imagen" 
              name="imagen" 
              (change)="onImageSelected($event)" 
              accept="image/jpeg,image/png,image/gif,image/webp"
              class="form-control"
              required>
            <small class="form-text">Formatos: JPG, PNG, GIF, WebP | Tamaño máximo: 5MB</small>
          </div>
        </section>
      </form>
    </div>
    
    <!-- Pie del Modal -->
    <footer class="modal-footer">
      <div class="modal-actions">
        <button 
          type="button" 
          class="btn btn-secondary"
          (click)="closeCreateModal()"
          [disabled]="loading">
          <i class="fas fa-times"></i>
          Cancelar
        </button>
        
        <button 
          type="submit" 
          class="btn btn-primary"
          (click)="createAnuncio()"
          [disabled]="!createForm?.valid || loading">
          <i class="fas fa-save"></i>
          {{ loading ? 'Creando...' : 'Crear Anuncio' }}
        </button>
      </div>
    </footer>
  </div>
</div>

<!-- MODAL PARA EDITAR ANUNCIO -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    
    <!-- Encabezado del Modal -->
    <header class="modal-header">
      <h3>
        <i class="fas fa-edit"></i>
        Editar Anuncio
      </h3>
      <button 
        class="modal-close" 
        (click)="closeEditModal()"
        type="button">
        <i class="fas fa-times"></i>
      </button>
    </header>
    
    <!-- Cuerpo del Modal -->
    <div class="modal-body">
      <form (ngSubmit)="updateAnuncio()" #editForm="ngForm">
        
        <!-- Información Básica -->
        <section class="form-section">
          <h4>
            <i class="fas fa-info-circle"></i>
            Información Básica
          </h4>
          
          <div class="form-row">
            <div class="form-group">
              <label for="edit-activo">Estado *</label>
              <select 
                id="edit-activo" 
                name="activo" 
                [(ngModel)]="anuncioForm.activo" 
                required 
                class="form-control">
                <option [ngValue]="true">Activo</option>
                <option [ngValue]="false">Inactivo</option>
              </select>
              <small class="form-text">Estado del anuncio</small>
            </div>
            
            <div class="form-group">
              <label for="edit-posicion">Posición *</label>
              <input 
                type="number" 
                id="edit-posicion" 
                name="posicion" 
                [(ngModel)]="anuncioForm.posicion" 
                required 
                min="0"
                class="form-control"
                placeholder="0">
              <small class="form-text">Orden de visualización (menor número = primero)</small>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="edit-fecha-inicio">Fecha de Inicio</label>
              <input 
                type="date" 
                id="edit-fecha-inicio" 
                name="fecha_inicio" 
                [(ngModel)]="anuncioForm.fecha_inicio" 
                class="form-control">
              <small class="form-text">Fecha desde la cual el anuncio estará activo</small>
            </div>

            <div class="form-group">
              <label for="edit-fecha-fin">Fecha de Fin</label>
              <input 
                type="date" 
                id="edit-fecha-fin" 
                name="fecha_fin" 
                [(ngModel)]="anuncioForm.fecha_fin" 
                class="form-control">
              <small class="form-text">Fecha hasta la cual el anuncio estará activo</small>
            </div>
          </div>
        </section>

        <!-- Imagen -->
        <section class="form-section">
          <h4>
            <i class="fas fa-camera"></i>
            Imagen
          </h4>
          
          <div class="form-group">
            <label for="edit-imagen">Imagen del Anuncio</label>
            
            <!-- Preview de imagen actual (si existe) -->
            <div class="image-preview" *ngIf="currentImageUrl && !selectedImagePreview">
              <img [src]="currentImageUrl" alt="Imagen actual" class="preview-image">
              <p class="preview-text">Imagen actual</p>
            </div>
            
            <!-- Preview de nueva imagen seleccionada -->
            <div class="image-preview" *ngIf="selectedImagePreview">
              <img [src]="selectedImagePreview" alt="Preview" class="preview-image">
              <p class="preview-text">Nueva imagen (reemplazará la actual)</p>
            </div>
            
            <input 
              type="file" 
              id="edit-imagen" 
              name="imagen" 
              (change)="onImageSelected($event)" 
              accept="image/jpeg,image/png,image/gif,image/webp"
              class="form-control">
            <small class="form-text">Formatos: JPG, PNG, GIF, WebP | Tamaño máximo: 5MB | Dejar vacío para mantener la imagen actual</small>
          </div>
        </section>
      </form>
    </div>
    
    <!-- Pie del Modal -->
    <footer class="modal-footer">
      <div class="modal-actions">
        <button 
          type="button" 
          class="btn btn-secondary"
          (click)="closeEditModal()"
          [disabled]="loading">
          <i class="fas fa-times"></i>
          Cancelar
        </button>
        
        <button 
          type="submit" 
          class="btn btn-primary"
          (click)="updateAnuncio()"
          [disabled]="!editForm?.valid || loading">
          <i class="fas fa-save"></i>
          {{ loading ? 'Actualizando...' : 'Actualizar Anuncio' }}
        </button>
      </div>
    </footer>
  </div>
</div>

<!-- MODAL DE CONFIRMACIÓN PARA ELIMINAR -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    
    <!-- Encabezado del Modal -->
    <header class="modal-header">
      <h3>
        <i class="fas fa-trash"></i>
        Confirmar Eliminación
      </h3>
      <button 
        class="modal-close" 
        (click)="closeDeleteModal()"
        type="button">
        <i class="fas fa-times"></i>
      </button>
    </header>
    
    <!-- Cuerpo del Modal -->
    <div class="modal-body">
      <div class="confirm-delete">
        <div class="warning-icon">
          <i class="fas fa-exclamation-triangle"></i>
        </div>
        
        <div class="warning-content">
          <h4>¿Estás seguro de que quieres eliminar este anuncio?</h4>
          <p *ngIf="selectedAnuncio">
            <strong>Posición: {{ selectedAnuncio.posicion }}</strong><br>
            <span>Estado: {{ getEstadoText(selectedAnuncio.activo) }}</span>
          </p>
          <p class="warning-text">
            Esta acción no se puede deshacer. El anuncio será eliminado permanentemente.
          </p>
        </div>
      </div>
    </div>
    
    <!-- Pie del Modal -->
    <footer class="modal-footer">
      <div class="modal-actions">
        <button 
          type="button" 
          class="btn btn-secondary"
          (click)="closeDeleteModal()"
          [disabled]="loading">
          <i class="fas fa-times"></i>
          Cancelar
        </button>
        
        <button 
          type="button" 
          class="btn btn-danger"
          (click)="deleteAnuncio()"
          [disabled]="loading">
          <i class="fas fa-trash"></i>
          {{ loading ? 'Eliminando...' : 'Eliminar Anuncio' }}
        </button>
      </div>
    </footer>
  </div>
</div>

