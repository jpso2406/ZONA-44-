<app-navbar></app-navbar>
<div class="forgot-password-container">
  <div class="forgot-password-card">
    <!-- Header -->
    <div class="forgot-password-header">
      <button class="back-btn" (click)="goBack()">
        <i class="fas fa-arrow-left"></i>
        Volver
      </button>
      <h1>{{ getStepTitle() }}</h1>
      <p>{{ getStepDescription() }}</p>
    </div>

    <!-- Messages -->
    <div class="message-container" *ngIf="message">
      <div class="alert" [class.alert-success]="messageType === 'success'" [class.alert-error]="messageType === 'error'">
        <i class="fas" [class.fa-check-circle]="messageType === 'success'" [class.fa-exclamation-triangle]="messageType === 'error'"></i>
        {{ message }}
      </div>
    </div>

    <!-- Form -->
    <form class="forgot-password-form" [formGroup]="forgotPasswordForm" (ngSubmit)="onSubmit()">
      
      <!-- Step 1: Email -->
      <div *ngIf="step === 1" class="form-step">
        <div class="form-group">
          <label class="form-label">
            <i class="fas fa-envelope"></i>
            Correo Electrónico
          </label>
          <div class="input-wrapper">
            <input
              type="email"
              class="form-input"
              formControlName="email"
              placeholder="ejemplo@correo.com"
              [class.error]="isFieldInvalid('email')"
            >
            <div class="input-indicator" *ngIf="email?.valid && email?.touched">
              <i class="fas fa-check"></i>
            </div>
          </div>
          <div class="field-error" *ngIf="isFieldInvalid('email')">
            {{ getFieldError('email') }}
          </div>
        </div>
      </div>

      <!-- Step 2: Code Verification -->
      <div *ngIf="step === 2" class="form-step">
        <div class="form-group">
          <label class="form-label">
            <i class="fas fa-key"></i>
            Código de Verificación
          </label>
          <div class="input-wrapper">
            <input
              type="text"
              class="form-input"
              formControlName="code"
              placeholder="123456"
              maxlength="6"
              [class.error]="isFieldInvalid('code')"
            >
            <div class="input-indicator" *ngIf="code?.valid && code?.touched">
              <i class="fas fa-check"></i>
            </div>
          </div>
          <div class="field-error" *ngIf="isFieldInvalid('code')">
            {{ getFieldError('code') }}
          </div>
        </div>
        
        <div class="resend-section">
          <p class="resend-text">¿No recibiste el código?</p>
          <button type="button" class="resend-btn" (click)="resendCode()" [disabled]="loading">
            <i class="fas fa-redo"></i>
            Reenviar código
          </button>
        </div>
      </div>

      <!-- Step 3: New Password -->
      <div *ngIf="step === 3" class="form-step">
        <div class="form-group">
          <label class="form-label">
            <i class="fas fa-lock"></i>
            Nueva Contraseña
          </label>
          <div class="input-wrapper">
            <input
              type="password"
              class="form-input"
              formControlName="password"
              placeholder="Mínimo 6 caracteres"
              [class.error]="isFieldInvalid('password')"
            >
            <div class="input-indicator" *ngIf="password?.valid && password?.touched">
              <i class="fas fa-check"></i>
            </div>
          </div>
          <div class="field-error" *ngIf="isFieldInvalid('password')">
            {{ getFieldError('password') }}
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">
            <i class="fas fa-lock"></i>
            Confirmar Contraseña
          </label>
          <div class="input-wrapper">
            <input
              type="password"
              class="form-input"
              formControlName="confirmPassword"
              placeholder="Confirma tu contraseña"
              [class.error]="isFieldInvalid('confirmPassword')"
            >
            <div class="input-indicator" *ngIf="confirmPassword?.valid && confirmPassword?.touched">
              <i class="fas fa-check"></i>
            </div>
          </div>
          <div class="field-error" *ngIf="isFieldInvalid('confirmPassword')">
            {{ getFieldError('confirmPassword') }}
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <button 
        type="submit" 
        class="btn-submit"
        [disabled]="loading || (step === 1 && email?.invalid) || (step === 2 && code?.invalid) || (step === 3 && forgotPasswordForm.invalid)"
      >
        <div class="btn-content" *ngIf="!loading">
          <i class="fas" 
             [class.fa-paper-plane]="step === 1" 
             [class.fa-check]="step === 2" 
             [class.fa-key]="step === 3">
          </i>
          <span *ngIf="step === 1">Enviar Código</span>
          <span *ngIf="step === 2">Verificar Código</span>
          <span *ngIf="step === 3">Cambiar Contraseña</span>
        </div>
        <div class="btn-loading" *ngIf="loading">
          <div class="loading-spinner"></div>
          <span>Procesando...</span>
        </div>
        <div class="btn-loading-bar" *ngIf="loading"></div>
      </button>
    </form>

    <!-- Footer -->
    <div class="forgot-password-footer">
      <p class="footer-text">
        ¿Recordaste tu contraseña? 
        <button class="footer-link" (click)="goBack()">Volver al login</button>
      </p>
    </div>
  </div>

  <!-- Background Elements -->
  <div class="bg-elements">
    <div class="floating-element" style="top: 10%; left: 10%; animation-delay: 0s;"></div>
    <div class="floating-element" style="top: 20%; right: 15%; animation-delay: 2s;"></div>
    <div class="floating-element" style="bottom: 30%; left: 20%; animation-delay: 4s;"></div>
    <div class="floating-element" style="bottom: 20%; right: 10%; animation-delay: 6s;"></div>
  </div>
</div>
<app-footer></app-footer>