<app-navbar></app-navbar>

<div class="reservas-container">
    <div class="container">
        <div class="header">
            <h1>{{ 'RESERVATIONS.TITLE' | translate }}</h1>
            <p>{{ 'RESERVATIONS.SUBTITLE' | translate }}</p>
        </div>

        <!-- Mensajes -->
        <div *ngIf="message" class="alert" [ngClass]="'alert-' + messageType">
            {{ message }}
        </div>

        <!-- Formulario de Nueva Reserva -->
        <div class="form-section" *ngIf="showForm">
            <h2>{{ 'RESERVATIONS.NEW_RESERVATION' | translate }}</h2>
            
            <!-- Indicador de usuario logueado -->
            <div *ngIf="currentUser" class="user-info">
                <p class="user-message">
                    <i class="fas fa-user-check"></i>
                    {{ 'RESERVATIONS.USER_GREETING' | translate: {name: currentUser.first_name} }}
                </p>
            </div>
            <form (ngSubmit)="createReservation()" #reservationForm="ngForm" [class.is-loading]="isLoading">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="name">{{ 'RESERVATIONS.FULL_NAME' | translate }} *</label>
                        <input 
                            type="text" 
                            id="name" 
                            name="name" 
                            [(ngModel)]="newReservation.name" 
                            required 
                            [disabled]="isLoading"
                            pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s'-]{2,}"
                            [placeholder]="'RESERVATIONS.FULL_NAME_PLACEHOLDER' | translate"
                            #nameCtrl="ngModel"
                            (keypress)="allowOnlyLetters($event)"
                            (input)="onNameInput()"
                        >
                        <div class="field-error" *ngIf="nameCtrl.invalid && (nameCtrl.dirty || nameCtrl.touched)">
                            <span *ngIf="nameCtrl.errors?.['required']">{{ 'RESERVATIONS.VALIDATION.NAME_REQUIRED' | translate }}</span>
                            <span *ngIf="nameCtrl.errors?.['pattern']">{{ 'RESERVATIONS.VALIDATION.NAME_PATTERN' | translate }}</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="email">{{ 'TRACKING.EMAIL' | translate }} *</label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            [(ngModel)]="newReservation.email" 
                            required 
                            [disabled]="isLoading"
                            pattern="[^\s@]+@[^\s@]+\.[^\s@]{2,}"
                            [placeholder]="'RESERVATIONS.EMAIL_PLACEHOLDER' | translate"
                            #emailCtrl="ngModel"
                        >
                        <div class="field-error" *ngIf="emailCtrl.invalid && (emailCtrl.dirty || emailCtrl.touched)">
                            <span *ngIf="emailCtrl.errors?.['required']">{{ 'RESERVATIONS.VALIDATION.EMAIL_REQUIRED' | translate }}</span>
                            <span *ngIf="emailCtrl.errors?.['pattern']">{{ 'RESERVATIONS.VALIDATION.EMAIL_PATTERN' | translate }}</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="phone">{{ 'TRACKING.PHONE' | translate }} *</label>
                        <input 
                            type="tel" 
                            id="phone" 
                            name="phone" 
                            [(ngModel)]="newReservation.phone" 
                            required 
                            [disabled]="isLoading"
                            pattern="[0-9+()\-\s]{7,20}"
                            [placeholder]="'RESERVATIONS.PHONE_PLACEHOLDER' | translate"
                            #phoneCtrl="ngModel"
                            (keypress)="allowOnlyPhoneChars($event)"
                            (input)="onPhoneInput()"
                        >
                        <div class="field-error" *ngIf="phoneCtrl.invalid && (phoneCtrl.dirty || phoneCtrl.touched)">
                            <span *ngIf="phoneCtrl.errors?.['required']">{{ 'RESERVATIONS.VALIDATION.PHONE_REQUIRED' | translate }}</span>
                            <span *ngIf="phoneCtrl.errors?.['pattern']">{{ 'RESERVATIONS.VALIDATION.PHONE_PATTERN' | translate }}</span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="people_count">{{ 'RESERVATIONS.PEOPLE_COUNT' | translate }} *</label>
                        <select 
                            id="people_count" 
                            name="people_count" 
                            [(ngModel)]="newReservation.people_count" 
                            required
                            [disabled]="isLoading"
                            #peopleCtrl="ngModel"
                        >
                            <option value="1">1 {{ 'RESERVATIONS.PEOPLE_SINGULAR' | translate }}</option>
                            <option value="2">2 {{ 'RESERVATIONS.PEOPLE_PLURAL' | translate }}</option>
                            <option value="3">3 {{ 'RESERVATIONS.PEOPLE_PLURAL' | translate }}</option>
                            <option value="4">4 {{ 'RESERVATIONS.PEOPLE_PLURAL' | translate }}</option>
                            <option value="5">5 {{ 'RESERVATIONS.PEOPLE_PLURAL' | translate }}</option>
                            <option value="6">6 {{ 'RESERVATIONS.PEOPLE_PLURAL' | translate }}</option>
                            <option value="7">7 {{ 'RESERVATIONS.PEOPLE_PLURAL' | translate }}</option>
                            <option value="8">8 {{ 'RESERVATIONS.PEOPLE_PLURAL' | translate }}</option>
                            <option value="9">9 {{ 'RESERVATIONS.PEOPLE_PLURAL' | translate }}</option>
                            <option value="10">10 {{ 'RESERVATIONS.PEOPLE_PLURAL' | translate }}</option>
                            <option value="12">12 {{ 'RESERVATIONS.PEOPLE_PLURAL' | translate }}</option>
                            <option value="15">15 {{ 'RESERVATIONS.PEOPLE_PLURAL' | translate }}</option>
                            <option value="20">20 {{ 'RESERVATIONS.PEOPLE_PLURAL' | translate }}</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="date">{{ 'RESERVATIONS.DATE' | translate }} *</label>
                        <input 
                            type="date" 
                            id="date" 
                            name="date" 
                            [(ngModel)]="newReservation.date" 
                            required
                            [min]="newReservation.date"
                            [disabled]="isLoading"
                            #dateCtrl="ngModel"
                        >
                    </div>

                    <div class="form-group">
                        <label for="time">{{ 'RESERVATIONS.TIME' | translate }} *</label>
                        <select 
                            id="time" 
                            name="time" 
                            [(ngModel)]="newReservation.time" 
                            required
                            [disabled]="isLoading"
                            #timeCtrl="ngModel"
                        >
                            <option value="">{{ 'RESERVATIONS.SELECT_TIME' | translate }}</option>
                            <option *ngFor="let time of timeSlots" [value]="time.value">
                                {{ getTimeLabel(time.value) }}
                            </option>
                        </select>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label for="comments">{{ 'RESERVATIONS.COMMENTS' | translate }}</label>
                    <textarea 
                        id="comments" 
                        name="comments" 
                        [(ngModel)]="newReservation.comments" 
                        [placeholder]="'RESERVATIONS.COMMENTS_PLACEHOLDER' | translate"
                        rows="3"
                        [disabled]="isLoading"
                    ></textarea>
                </div>

                <div class="form-actions">
                    <button 
                        type="submit" 
                        class="btn btn-primary" 
                        [disabled]="isLoading"
                    >
                        <span *ngIf="isLoading">{{ 'RESERVATIONS.CREATING' | translate }}</span>
                        <span *ngIf="!isLoading">{{ 'RESERVATIONS.CREATE_BUTTON' | translate }}</span>
                    </button>
                </div>

                <!-- Overlay de carga -->
                <div class="form-overlay" *ngIf="isLoading">
                    <div class="spinner"></div>
                    <div class="loading-text">{{ 'RESERVATIONS.SENDING' | translate }}</div>
                </div>
            </form>
        </div>

    </div>
</div>