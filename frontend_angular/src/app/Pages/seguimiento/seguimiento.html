<app-navbar></app-navbar>

<div class="seguimiento-container">
  <div class="seguimiento-content">
    <!-- Header Section -->
    <div class="header-section">
      <div class="icon-wrapper">
        <i class="fas fa-search"></i>
      </div>
      <h1 class="title">{{ 'TRACKING.TITLE' | translate }}</h1>
      <p class="subtitle">{{ 'TRACKING.SUBTITLE' | translate }}</p>
    </div>

    <!-- Search Form -->
    <div class="search-form" *ngIf="!orderData">
      <div class="form-card">
        <div class="form-group">
          <label for="orderNumber">
            <i class="fas fa-hashtag"></i>
            {{ 'TRACKING.ORDER_NUMBER' | translate }}
          </label>
          <input 
            type="text" 
            id="orderNumber"
            [(ngModel)]="orderNumber"
            [placeholder]="'TRACKING.ORDER_NUMBER_PLACEHOLDER' | translate"
            class="form-input"
            [disabled]="loading"
          />
        </div>

        <div class="form-group">
          <label for="email">
            <i class="fas fa-envelope"></i>
            {{ 'TRACKING.EMAIL' | translate }}
          </label>
          <input 
            type="email" 
            id="email"
            [(ngModel)]="email"
            [placeholder]="'TRACKING.EMAIL_PLACEHOLDER' | translate"
            class="form-input"
            [disabled]="loading"
          />
        </div>

        <button 
          class="search-btn"
          (click)="trackOrder()"
          [disabled]="loading || !orderNumber || !email"
        >
          <i class="fas fa-search" *ngIf="!loading"></i>
          <i class="fas fa-spinner fa-spin" *ngIf="loading"></i>
          <span>{{ loading ? ('TRACKING.SEARCHING' | translate) : ('TRACKING.SEARCH_BUTTON' | translate) }}</span>
        </button>

        <!-- Error Message -->
        <div class="error-message" *ngIf="error && searched">
          <i class="fas fa-exclamation-circle"></i>
          <span>{{ error | translate }}</span>
        </div>
      </div>
    </div>

    <!-- Order Details -->
    <div class="order-details" *ngIf="orderData">
      <!-- Order Header Info -->
      <div class="order-header">
        <div class="order-info-card">
          <div class="order-number-badge">
            <i class="fas fa-receipt"></i>
            <div>
              <span class="label">{{ 'TRACKING.ORDER' | translate }}</span>
              <span class="value">{{ orderData.order_number }}</span>
            </div>
          </div>
          <div class="order-meta">
            <div class="meta-item">
              <i class="fas fa-calendar"></i>
              <span>{{ formatDate(orderData.created_at) }}</span>
            </div>
            <div class="meta-item">
              <i class="fas fa-wallet"></i>
              <span>{{ formatPrice(orderData.total_amount) }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Timeline -->
      <div class="timeline-section">
        <h2 class="section-title">
          <i class="fas fa-route"></i>
          {{ 'TRACKING.ORDER_STATUS' | translate }}
        </h2>
        
        <!-- Timeline Normal (pending, processing, paid) -->
        <div class="timeline" *ngIf="!isStatusFailed() && !isStatusCancelled()">
          <div 
            class="timeline-item"
            *ngFor="let status of orderStatuses.slice(0, 3); let i = index"
            [class.completed]="isStatusCompleted(status.key)"
            [class.active]="isStatusActive(status.key)"
          >
            <div class="timeline-marker">
              <div class="marker-dot">
                <i [class]="'fas ' + status.icon"></i>
              </div>
              <div class="marker-line" *ngIf="i < 2"></div>
            </div>
            <div class="timeline-content">
              <h3>{{ 'TRACKING.STATUS.' + status.key.toUpperCase() | translate }}</h3>
              <p *ngIf="isStatusActive(status.key)">{{ 'TRACKING.STATUS.CURRENT' | translate }}</p>
              <p *ngIf="isStatusCompleted(status.key) && !isStatusActive(status.key)">{{ 'TRACKING.STATUS.COMPLETED' | translate }}</p>
            </div>
          </div>
        </div>

        <!-- Timeline Failed -->
        <div class="timeline timeline-error" *ngIf="isStatusFailed()">
          <div class="timeline-item active failed">
            <div class="timeline-marker">
              <div class="marker-dot">
                <i class="fas fa-times-circle"></i>
              </div>
            </div>
            <div class="timeline-content">
              <h3>{{ 'TRACKING.STATUS.FAILED' | translate }}</h3>
              <p>{{ 'TRACKING.STATUS.FAILED_MESSAGE' | translate }}</p>
            </div>
          </div>
        </div>

        <!-- Timeline Cancelled -->
        <div class="timeline timeline-error" *ngIf="isStatusCancelled()">
          <div class="timeline-item active cancelled">
            <div class="timeline-marker">
              <div class="marker-dot">
                <i class="fas fa-ban"></i>
              </div>
            </div>
            <div class="timeline-content">
              <h3>{{ 'TRACKING.STATUS.CANCELLED' | translate }}</h3>
              <p>{{ 'TRACKING.STATUS.CANCELLED_MESSAGE' | translate }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Customer Info -->
      <div class="info-section">
        <h2 class="section-title">
          <i class="fas fa-user"></i>
          {{ 'TRACKING.CUSTOMER_INFO' | translate }}
        </h2>
        <div class="info-grid">
          <div class="info-card" *ngIf="orderData.customer_name">
            <i class="fas fa-user"></i>
            <div>
              <span class="info-label">{{ 'TRACKING.NAME' | translate }}</span>
              <span class="info-value">{{ orderData.customer_name }}</span>
            </div>
          </div>
          <div class="info-card" *ngIf="orderData.customer_email">
            <i class="fas fa-envelope"></i>
            <div>
              <span class="info-label">{{ 'TRACKING.EMAIL' | translate }}</span>
              <span class="info-value">{{ orderData.customer_email }}</span>
            </div>
          </div>
          <div class="info-card" *ngIf="orderData.customer_phone">
            <i class="fas fa-phone"></i>
            <div>
              <span class="info-label">{{ 'TRACKING.PHONE' | translate }}</span>
              <span class="info-value">{{ orderData.customer_phone }}</span>
            </div>
          </div>
          <div class="info-card" *ngIf="orderData.customer_address || orderData.customer_city">
            <i class="fas fa-map-marker-alt"></i>
            <div>
              <span class="info-label">{{ 'TRACKING.ADDRESS' | translate }}</span>
              <span class="info-value">
                <span *ngIf="orderData.customer_address">{{ orderData.customer_address }}</span>
                <span *ngIf="orderData.customer_address && orderData.customer_city">, </span>
                <span *ngIf="orderData.customer_city">{{ orderData.customer_city }}</span>
                <span *ngIf="!orderData.customer_address && !orderData.customer_city">{{ 'TRACKING.NO_ADDRESS' | translate }}</span>
              </span>
            </div>
          </div>
        </div>
        <div class="special-instructions" *ngIf="orderData.special_instructions">
          <i class="fas fa-comment-alt"></i>
          <div>
            <span class="info-label">{{ 'TRACKING.SPECIAL_INSTRUCTIONS' | translate }}</span>
            <span class="info-value">{{ orderData.special_instructions }}</span>
          </div>
        </div>
      </div>

      <!-- Order Items -->
      <div class="items-section">
        <h2 class="section-title">
          <i class="fas fa-shopping-bag"></i>
          {{ 'TRACKING.ORDERED_PRODUCTS' | translate }}
        </h2>
        <div class="items-list">
          <div class="item-card" *ngFor="let item of orderData.order_items">
            <div class="item-info">
              <h3>{{ item.producto.nombre }}</h3>
              <p *ngIf="item.producto.descripcion">{{ item.producto.descripcion }}</p>
              <div class="item-meta">
                <span class="quantity">
                  <i class="fas fa-times"></i>
                  {{ item.quantity }}
                </span>
                <span class="price">{{ formatPrice(item.total_price) }}</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Total -->
        <div class="order-total">
          <span>{{ 'TRACKING.TOTAL' | translate }}</span>
          <span class="total-amount">{{ formatPrice(orderData.total_amount) }}</span>
        </div>
      </div>

      <!-- New Search Button -->
      <button class="new-search-btn" (click)="resetForm()">
        <i class="fas fa-search"></i>
        <span>{{ 'TRACKING.NEW_SEARCH' | translate }}</span>
      </button>
    </div>
  </div>
</div>

<app-footer></app-footer>